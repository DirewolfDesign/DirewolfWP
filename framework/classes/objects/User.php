<?php
/*============================================================================*/
/* User Object Class
/*============================================================================*/
/* Base class for managing user data
/*============================================================================*/
/* @since       1.0.0
/* @version     1.0.0
/*============================================================================*/
/* @package     Direwolf
/* @subpackage  Plugin/Framework
/* @author      Direwolf Design <nate@direwolfdesign.co>
/* @copyright   2018 Direwolf Design
/* @license     GPL-2.0+
/*============================================================================*/

/*============================================================================*/
/* Plugin Namespace: Direwolf
/*============================================================================*/
namespace Direwolf;

/*============================================================================*/
/* @class User
/*============================================================================*/
/* Sets up and manages a User object
/*============================================================================*/
/* @since       1.0.0
/* @version     1.0.0
/*============================================================================*/
/* @package     Direwolf
/* @subpackage  Plugin/Framework
/* @author      Direwolf Design <nate@direwolfdesign.co>
/* @copyright   2018 Direwolf Design
/* @license     GPL-2.0+
/*============================================================================*/
/* @param       (int)       $userID     The ID of the user
/*============================================================================*/
class User {
    
    
    
/*============================================================================*/
/* CLASS PROPERTIES
/*============================================================================*/
    
    
    /*========================================================================*/
    /* @var $ID
    /*========================================================================*/
    /* The user's ID
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public $ID = false;
    
    /*========================================================================*/
    /* @var $_wp_user
    /*========================================================================*/
    /* The WP_User object returned by `get_user()`
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /* @access      private
    /*========================================================================*/
    private $_wp_user = null;
    
    /*========================================================================*/
    /* @var $data
    /*========================================================================*/
    /* An object containing the required user data parsed from $_wp_user
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public $data = null;
    
    /*========================================================================*/
    /* @var $profile
    /*========================================================================*/
    /* An object containing profile specific data for this user
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public $profile = null;
    
    /*========================================================================*/
    /* @var $customer
    /*========================================================================*/
    /* An object containing stripe customer data for this user
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public $customer = null;
    
    
    
/*============================================================================*/
/* CONSTRUCTOR METHODS
/*============================================================================*/
    
    
    
    /*========================================================================*/
    /* Class Constructor
    /*========================================================================*/
    /* An object containing stripe customer data for this user
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    /* @param       (int)       $userID     The ID of the user
    /*========================================================================*/
    public function __construct( $userID = false ) {
        $this->setup( $userID );
    }
    
    
    
/*============================================================================*/
/* SETUP METHODS
/*============================================================================*/
    
    
    
    /*========================================================================*/
    /* Object Setup
    /*========================================================================*/
    /* Sets up the default user object data from the returned WP_User object
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    /* @param       (int)       $userID     The ID of the user
    /*========================================================================*/
    private function setup( $userID ) {
        $this->ID = $userID;
        
        try {
            $user = get_user_by( 'id', $this->ID );
            if( is_wp_error( $user ) ){ throw new Exception( $user ); }
            
            $this->_wp_user = $user;
            
            $this->setData();
            
            unset( $this->_wp_user );
        } catch( \Exception $e ) { wp_die( $e ); }
    }
    
    
    
/*============================================================================*/
/* USER DATA METHODS
/*============================================================================*/
    
    
    
    /*========================================================================*/
    /* Set Data
    /*========================================================================*/
    /* Parses the $_wp_user object and sets required User Account data
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    private function setData() {
        $additional_fields = apply_filters( 'direwolf/user/data/fields', array(), $this );
        
        $this->data = (object) wp_parse_args( $additional_fields, array(
            'ID' => $this->_wp_user->ID,
            'first_name' => $this->_wp_user->first_name,
            'last_name' => $this->_wp_user->last_name,
            'username' => $this->_wp_user->user_nicename,
            'email' => $this->_wp_user->user_email
        ));
    }
    
    /*========================================================================*/
    /* Get Data
    /*========================================================================*/
    /* Returns the User's Account data
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public function getData() {
        return $this->data;
    }
    
    /*========================================================================*/
    /* Update Data
    /*========================================================================*/
    /* Updates the User's Account Data
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    /* @param       (array)     $newData    An array of new account data to be
    /*                                      set for the User
    /*========================================================================*/
    public function updateData( $newData = array() ) {
        $oldData = (array) $this->data;
        $data = wp_parse_args( $newData, $oldData );
        
        try {
            $update = wp_update_user( $data );
            if( is_wp_error( $update ) ) { throw new \Exception( $update ); }
            
            $this->data = $data;
        } catch ( \Exception $e ) { wp_die( $e ); }
        
    }
    
    
    
/*============================================================================*/
/* USER PROFILE METHODS
/*============================================================================*/
    
    
    
    /*========================================================================*/
    /* Set Profile
    /*========================================================================*/
    /* Sets the user's profile data from a mixture of User Data and User Meta 
    /* Data
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public function setProfile() {
        $this->profile = (object) array(
            'username' => $this->data->username,
            'full_name' => sprintf( '%1$s %2$s', $this->data->first_name, $this->data->last_name ),
            'first_name' => $this->data->first_name,
            'last_name' => $this->data->last_name,
            'email' => $this->data->email
        );
    }
    
    /*========================================================================*/
    /* Get Profile
    /*========================================================================*/
    /* Returns the User's Profile Data
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public function getProfile() {
        return $this->profile;
    }
    
    /*========================================================================*/
    /* Update Profile
    /*========================================================================*/
    /* Updates the User's Profile Data
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    /* @param       (array)     $newData    An array of new profile data to be
    /*                                      set for the User
    /*========================================================================*/
    public function updateProfile( $newData = array() ) {}
    
    
    
/*============================================================================*/
/* CUSTOMER METHODS
/*============================================================================*/
    
    
    
    /*========================================================================*/
    /* Set Customer
    /*========================================================================*/
    /* Sets the User's Customer Data from Stripe
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    private function setCustomer() {}
    
    /*========================================================================*/
    /* Get Customer
    /*========================================================================*/
    /* Returns the User's Customer Data
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public function getCustomer() {}
    
    /*========================================================================*/
    /* Update Customer
    /*========================================================================*/
    /* Updates the User's Customer Data
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    /* @param       (array)     $newData    An array of new Customer data to be
    /*                                      set for the User
    /*========================================================================*/
    public function updateCustomer( $newData = array() ) {}
    
    /*========================================================================*/
    /* Create Customer
    /*========================================================================*/
    /* Creates a new Customer Object for this User
    /*========================================================================*/
    /* @since       1.0.0
    /* @version     1.0.0
    /*========================================================================*/
    public function createCustomer() {}
    
}